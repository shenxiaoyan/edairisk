"use strict";app.controller("workflowEntityModuleController",["$rootScope","$scope","$state","$stateParams",function(a,b,c,d){console.log("workflowEntityModuleController")}]);app.controller("workflowEntityListController",["$rootScope","$scope","$http","$stateParams","entity",function(a,c,e,d,b){if(d.entity_key==="orderwdsjsh"){c.entity_key=d.entity_key+"e"}else{c.entity_key=d.entity_key}c.states=[];b.getList("/rest/"+d.entity_key+"Workflows/ "+d.workflow_id+"/states").then(function(f){c.states=f._embeddedItems;if(c.states.length>0){c.states=c.states.sort(function(h,g){return h.sort-g.sort});c.state_code=c.states[0].stateCode;c.getList(0)}});c.pageList={size:0,total_elements:0,current_page:0,num_page:1,total_page:1};c.list=[];c.getList=function(g){c.loading=true;c.list=[];var f="/rest/"+c.entity_key+"s/search/listStateOwnDepartmentAndChildren?sort=id,desc&stateCode="+c.state_code+"&size=20&page="+g;b.getList(f,["state"]).then(function(h){c.loading=false;c.list=h._embeddedItems;c.pageList={size:h.page.size,total_elements:h.page.totalElements,current_page:h.page.number,num_page:h.page.totalPages,total_page:h.page.totalPages};if(c.list.length>0){a.setPaginator("#"+d.entity_key+"_list_paginator",c.pageList,c.getList)}})};c.stateSelect=function(f,g){if(f.target.nodeName==="INPUT"){c.state_code=g;c.getList(0)}}}]);app.controller("workflowEntityHomeController",["$rootScope","$scope","$http","$state","$stateParams","entity",function(a,c,e,d,b){if(d.entity_key==="orderwdsjsh"){c.entity_key="orderwdsjshe"}else{c.entity_key=d.entity_key}c.id=d.id;c.profile={};c.canActs=[];b.getDetail("/rest/"+c.entity_key+"s/"+c.id,["createdBy","state"]).then(function(f){c.profile=f;c.canActs=[];c.canFileActs=[];angular.forEach(c.profile.currentUserCanActList,function(h,g){if(h.actGroup==="UPDATE"||h.actGroup==="OPERATE"||h.actGroup==="FILE_PACKAGE"){c.canActs.push(h)}else{if(h.actGroup==="FILE_OPERATE"){c.canFileActs.push(h)}}});c.state_code=c.profile.state.stateCode;c.stateActList=c.profile.stateActList[c.state_code]});c.excute=function(f){if(f==="update"){$state.go("workflowEntity.home.profile.update",{},{reload:true})}};console.log("workflowEntityHomeController")}]);app.controller("workflowEntityProfileController",["$rootScope","$scope","$http","$stateParams","$state",function(a,b,e,d,c){console.log("workflowEntityProfileController")}]);app.controller("workflowEntityInfoController",["$rootScope","$scope","$http","$stateParams","$state",function(a,b,e,d,c){console.log("workflowEntityInfoController")}]);app.controller("workflowEntityLogController",["$rootScope","$scope","$http","$stateParams","$state","entity",function(a,c,f,e,d,b){if(e.entity_key==="orderwdsjsh"){c.entity_key=e.entity_key+"e"}else{c.entity_key=e.entity_key}c.id=e.id;c.logs=[];b.getList("/rest/"+c.entity_key+"s/"+c.id+"/logs").then(function(g){c.logs=g._embeddedItems;angular.forEach(c.logs,function(i,h){b.getDetail(i._links.createdBy.href).then(function(j){i.createdBy=j.nickname;i.avatar=j.headimgurl})});c.logs.sort(function(i,h){return new Date(h.lastModifiedAt)-new Date(i.lastModifiedAt)})});c.jumpToLog=function(g){c.log=g;$("#log_modal").modal("show")}}]);app.controller("workflowEntityFileController",["$rootScope","$scope","$http","$stateParams","$state","FileUploader","entity",function(a,c,g,e,d,f,b){if(e.entity_key==="orderwdsjsh"){c.entity_key=e.entity_key+"e"}else{if(e.entity_key==="loancollection"){c.entity_key="loan"}else{c.entity_key=e.entity_key}}c.id=e.id;c.level2Tree=[];c.level3Tree=[];c.firstFolder={opened:true,folderName:""};c.secondFolder={opened:false,folderName:""};c.thirdFolder={opened:false,folderName:""};b.getDetail("/rest/"+c.entity_key+"s/"+c.id).then(function(h){if(JSON.stringify(h.fileCategoryTree)!=="{}"){c.fileTree=h.fileCategoryTree}else{c.fileTree=null}});c.jumpToLevel2=function(i,h){c.firstFolder.folderName=i;c.secondFolder.folderName="";c.level2Tree=h;c.firstFolder.opened=false;c.secondFolder.opened=true;c.thirdFolder.opened=false};c.jumpToLevel3=function(h){c.secondFolder.folderName=h;b.getList("/rest/"+e.entity_key+"Files/search/findByEntityIdAndTopcategoryAndSubcategory?id="+c.id+"&topcategory="+c.firstFolder.folderName+"&subcategory="+c.secondFolder.folderName).then(function(i){c.level3Tree=i._embeddedItems.sort(function(k,j){return k.id-j.id});c.firstFolder.opened=false;c.secondFolder.opened=false;c.thirdFolder.opened=true})};c.backFolder=function(){if(c.thirdFolder.opened){c.firstFolder.opened=false;c.secondFolder.opened=true;c.thirdFolder.opened=false}else{if(c.secondFolder.opened){c.firstFolder.opened=true;c.secondFolder.opened=false;c.thirdFolder.opened=false}}c.secondFolder.folderName=""};c.uploader=new f({url:"/fileUpload"});c.uploader.filters.push({name:"customFilter",fn:function(i,h){return this.queue.length<20}});c.uploader.onAfterAddingFile=function(h){h.actCode=c.actCode;if(h.file.type.indexOf("image")!==-1){h.formData=[{fileType:"image"}]}else{h.formData=[{fileType:"file"}]}};c.uploader.onErrorItem=function(j,i,h,k){a.toasterError("上传失败！",c.subcategory+"："+j.file.name+" 上传失败！")};c.uploader.onSuccessItem=function(j,i,h,k){i.result.topcategory=c.topcategory;i.result.subcategory=c.subcategory;g({method:"PATCH",url:"rest/"+c.entity_key+"s/"+c.id,data:{fileObject:i.result,act:j.actCode}}).success(function(l){a.toasterSuccess("上传成功！",c.subcategory+"："+j.file.name+" 上传成功！")})};c.uploader.onCompleteAll=function(){};$("#upload_file_modal").on("hidden.bs.modal",function(h){d.reload()});c.currentFile={};c.currentIndex=0;c.openFileCarousel=function(h){c.currentFile=c.level3Tree[h];c.currentIndex=h;$("#carousel_file_modal").modal("show")};c.prevFile=function(){if(c.currentIndex-1<0){a.toasterInfo("提示！","已经是第一张啦！")}else{c.currentFile=c.level3Tree[c.currentIndex-1];c.currentIndex-=1}};c.nextFile=function(){if(c.currentIndex+1>c.level3Tree.length-1){a.toasterInfo("提示！","已经是最后一张啦！")}else{c.currentFile=c.level3Tree[c.currentIndex+1];c.currentIndex+=1}};c.isImage=function(h){var i=false;switch(h.fileType){case"JPEG":i=true;break;case"PNG":i=true;break;case"GIF":i=true;break;case"TIFF":i=true;break;case"BMP":i=true;break}return i}}]);